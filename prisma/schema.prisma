generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Pet {
  id          String          @id @default(uuid())
  name        String          @db.VarChar(40)
  species     PetSpecies
  birth_date  DateTime        @db.Date
  description String?         @db.VarChar(300)
  status      PetStatus       @default(AVAILABLE)
  size        PetSize
  personality PetPersonality?
  adoptions   Adoption?
}

enum PetSpecies {
  DOG
  CAT
  RABBIT
  FISH
  BIRD
  TURTLE
  SNAKE
  OTHER
}

enum PetStatus {
  AVAILABLE
  ADOPTED
}

enum PetSize {
  SMALL
  MEDIUM
  LARGE
}

enum PetPersonality {
  CALM
  AGGRESSIVE
  PLAYFUL
  INDEPENDENT
  DEPENDENT
  LOYAL
  CURIOUS
  LOVING
}

model User {
  id       String      @id @default(uuid())
  name     String      @db.VarChar(40)
  email    String      @unique
  password String
  access   AccessLevel @default(ADOPTER)
  adopter  Adopter?
}

enum AccessLevel {
  ADMIN
  ADOPTER
}

model Adopter {
  user_id   String     @unique
  user      User       @relation(fields: [user_id], references: [id])
  phone     String     @db.VarChar(13)
  adress    Adress?
  adoptions Adoption[]

  @@id(user_id) // Chave primária de adotante é a mesma de usuario
}

model Adress {
  adopter_id   String  @unique
  adopter      Adopter @relation(fields: [adopter_id], references: [user_id], map: "fk_adopter", onDelete: Cascade)
  street       String
  number       String
  neighborhood String
  city         String

  @@id(adopter_id) // Chave primária de endereço é a mesma de adotante
}

// /TODO: Verificar se pet e adopter estao limitados de 1 pra 1
model Adoption {
  pet_id        String   @unique
  pet           Pet      @relation(fields: [pet_id], references: [id], map: "fk_pet")
  adopter_id    String
  adopter       Adopter  @relation(fields: [adopter_id], references: [user_id], map: "fk_adopter")
  adoption_date DateTime @default(now())

  @@id([pet_id, adopter_id]) // Chave primária de adoção é composta por pet e adotante
}
